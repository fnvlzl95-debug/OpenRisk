# OpenRisk 개발 일지

## 2025-12-31 Skin 1 UI 개선 및 마진 조정

### 완료된 작업

#### 1. 타이틀 변경
Skin 1 메인 페이지 타이틀을 Skin 2와 동일하게 변경

- "오픈리스크" → "상권의 진실을 마주하세요."
- 서브타이틀: "서울시 빅데이터 기반 상권 리스크 분석 엔진"

#### 2. 뷰포트 최적화를 위한 마진 조정
초기 화면에서 핵심 콘텐츠가 보이도록 컴팩트한 레이아웃 적용

| 구간 | Before | After |
|------|--------|-------|
| 히어로 → 검색폼 | mb-8 sm:mb-12 | mb-6 sm:mb-10 |
| 검색폼 → 예시 | mb-8 sm:mb-10 | mb-6 sm:mb-8 |
| 예시 → 등급체계 | mb-10 sm:mb-12 | mb-6 sm:mb-8 |
| 등급체계 라벨 → 카드 | mb-4 sm:mb-6 | mb-2 sm:mb-3 |
| 등급카드 → 통계 | mt-10 sm:mt-16 | mt-6 sm:mt-10 |

#### 3. 가독성 개선 (이전 세션)
- Skin 1 폰트 크기 증가 (text-base 기준)
- 명도 대비 개선 (text-zinc-400 → 적정 대비율 확보)

### 수정된 파일
- `app/page.tsx` - 타이틀 변경, 마진 조정

---

## 2025-12-30 (3차) 툴팁 시스템 및 모바일 UX 개선

### 완료된 작업

#### 1. 툴팁 컴포넌트 구현 (`components/Tooltip.tsx`)
마우스 호버 시 설명을 표시하는 툴팁 컴포넌트 개발

- React Portal 사용 (overflow 클리핑 방지)
- 위치 자동 조정 (화면 경계 처리)
- 테두리 있는 화살표 스타일
- 스크롤 시 자동 닫힘
- 다크 테마 적용 (`#1f1f24` 배경)

#### 2. 섹션별 툴팁 적용
결과 페이지 모든 섹션에 설명 툴팁 추가

- **인구 구성**: 거주인구/직장인구 비율 설명
- **유동인구**: 분기 유동인구 데이터 설명
- **분석 결과**: 등급/특성/마케팅탄성/상권변화 설명
- **분석 지표**: 개폐업변동/유동인구/비용압박/경쟁밀도/주말비중/시간대편차 설명
- **핵심 해석/확인사항/리스크**: 각 섹션 목적 설명
- **지도**: 상권 위치 시각화 설명

#### 3. 검색어 표시 기능
사용자가 검색한 키워드와 매칭된 상권명을 함께 표시

- API 응답에 `searchQuery` 필드 추가
- `AnalysisResult` 타입에 `searchQuery` 추가
- 상권명과 검색어가 다를 경우 "OOO 검색 결과" 표시
- 색상: `text-secondary`로 가시성 확보

#### 4. 모바일 레이아웃 개선
유동인구 숫자 줄바꿈 문제 해결

- `text-data-sm` 폰트 크기 축소 (1rem → 0.875rem)
- 숫자에 `whitespace-nowrap` 적용
- 천 단위 구분자(,) 포함 숫자 줄바꿈 방지

#### 5. 분석 지표 정리
중복 지표 제거 및 정리

- `gradeEngine.ts`에서 `worker_index` 제거 (인구 구성 섹션과 중복)
- 분석 지표: 유동인구, 개폐업변동, 비용압박, 경쟁밀도, 주말비중, 시간대편차
- 등급 유형에 따라 상위 3개 지표만 표시

#### 6. 텍스트 크기 조정
상세 정보 텍스트 크기 최적화

- 등급/특성/마케팅탄성/상권변화 값 텍스트
- `text-data-sm` → `text-body`로 변경

### 수정된 파일
- `components/Tooltip.tsx` - 툴팁 컴포넌트 (신규)
- `app/result/page.tsx` - 툴팁 적용, 검색어 표시, whitespace-nowrap
- `app/skin-b/result/page.tsx` - 검색어 표시
- `app/api/analyze/route.ts` - searchQuery 필드 추가
- `lib/types.ts` - AnalysisResult에 searchQuery 추가
- `lib/engine/gradeEngine.ts` - worker_index 제거
- `app/globals.css` - text-data-sm 모바일 폰트 크기 조정

---

## 2025-12-30 (2차) Phase 2-C 완료 및 UX 개선

### 완료된 작업

#### 1. 리스크 해석 도구로 포지셔닝 변경
서비스 목적을 "상권 컨설팅"에서 "리스크 해석 도구"로 명확히 재정의

- "추천합니다", "안전합니다" 등 주관적 표현 제거
- "~할 수 있습니다", "~인 구조입니다" 등 사실 기반 표현으로 변경
- 법적 면책 조항 추가 (등급계산로직.md 8장)

#### 2. 데이터 커버리지 지표 추가
기존 "신뢰도 %" 제거, 데이터 기반 커버리지로 대체

- `dataQuality` 필드 API 응답에 추가
- 8개 지표 중 유효 데이터 개수 표시 (예: "8/8개 지표")
- high/medium/low 3단계 커버리지 레벨
- types.ts에 `DataQuality`, `DataCoverage` 타입 추가

#### 3. copyRenderer.ts 문구 전면 개선
등급별 해석 문구를 중립적/사실 기반으로 전면 수정

- A등급: "유리한 환경" → "단골 중심 소비 패턴이 관찰되는 구조"
- 모든 등급: "추천" → "확인하기" 액션 가이드로 변경
- UI 라벨: "추천 액션" → "확인할 사항", "주의 리스크" → "리스크 요인"

#### 4. 결과 페이지 UI 라벨 변경
양쪽 스킨(기본, skin-b) 모두 적용

- `app/result/page.tsx`
- `app/skin-b/result/page.tsx`
- 데이터 커버리지 패널 추가

#### 5. 문서 파일명 한국어화
- GRADE_LOGIC.md → 등급계산로직.md
- CHANGELOG.md → 개발일지.md
- DATA_SPEC.md → 데이터명세서.md
- DATA_METRICS.md → 지표현황.md
- DATA_ENHANCEMENT.md → 데이터보강계획.md
- ACCURACY_ROADMAP.md → 정확도개선로드맵.md

---

## 2024-12-30 (1차) 엔진 분리 및 UI 개선

### 완료된 작업

#### 1. 엔진 분리 (`lib/engine/`)
로직을 별도 모듈로 분리하여 유지보수성 향상

- `lib/engine/gradeEngine.ts` - 등급 계산 로직
  - `calculateGrade()`: 유동인구, 시간대 편차, 주말 비중 기반 A-D 등급 산출
  - `calculateDisplayMetrics()`: 표시용 지표 계산

- `lib/engine/copyRenderer.ts` - 해석 문구 렌더러
  - `getGradeCopy()`: 등급별 coreCopy, actions, risks 반환
  - `getGradeSummary()`: 등급별 한 줄 요약

- `lib/engine/index.ts` - 모듈 exports

- `app/api/analyze/route.ts` 리팩토링
  - 로컬 함수 제거, 엔진 모듈에서 import

#### 2. 지도 시각화 (카카오맵)
- `components/AreaMap.tsx` 생성
  - 카카오 Maps SDK 동적 로드
  - 마커, 반경 원(300m), 상권명 오버레이 표시
  - 등급별 색상 적용

- 카카오 API 키 설정
  - `.env.local`에 `NEXT_PUBLIC_KAKAO_MAP_KEY` 추가
  - 카카오 개발자 콘솔에서 Web 플랫폼 도메인 등록

#### 3. 결과 페이지 UI 개선
- 레이아웃 재구성
  - 왼쪽: 정보카드 + 유동인구 카드 (세로 배치)
  - 오른쪽: 지도 (전체 높이)

- 정보카드 통일
  - 등급/유형/난이도/신뢰도 panel 스타일 통일
  - `flex flex-col gap-2`로 라벨-값 간격 조정
  - `text-data-sm` 폰트 스타일 통일

- 유동인구 카드
  - 총/평일/주말 3열 grid
  - 동일한 panel 스타일 적용

#### 4. 디자인 시스템 수정
- 폰트 변경: Departure Mono → Pretendard
- 색상 가시성 개선
  - `stat-label`: `--text-tertiary` → `--text-secondary`
  - `data-label`: `--text-tertiary` → `--text-secondary`
  - `stat-unit`: `--text-tertiary` → `--text-secondary`

---

## 남은 작업

### Phase 2 (단기)
- [ ] 검색 자동완성 기능
- [ ] 상권 폴리곤 시각화 (원형 → 실제 폴리곤)
- [ ] 모바일 반응형 최적화
- [ ] 로딩 스켈레톤 UI

### Phase 3 (중기)
- [ ] lv4 분석 기능 (업종별 상세 분석)
- [ ] 비교 분석 기능 (2개 상권 비교)
- [ ] 분석 결과 PDF 다운로드
- [ ] 분석 결과 공유 기능

### Phase 4 (장기)
- [ ] 사용자 인증 (로그인/회원가입)
- [ ] 분석 이력 저장
- [ ] 즐겨찾기 상권
- [ ] 알림 기능 (상권 변동 알림)

---

## 실제 서비스를 위해 필요한 것

### 인프라
- [ ] Vercel 배포 설정
- [ ] 커스텀 도메인 연결
- [ ] SSL 인증서 (자동)
- [ ] CDN 설정

### 보안
- [ ] 환경 변수 관리 (Vercel 환경 변수)
- [ ] API Rate Limiting
- [ ] CORS 설정
- [ ] CSP (Content Security Policy)

### 데이터
- [ ] 데이터 업데이트 자동화 (분기별)
- [ ] 데이터 백업 정책
- [ ] 상권 폴리곤 데이터 보강
- [ ] 업종별 데이터 추가

### 모니터링
- [ ] 에러 트래킹 (Sentry)
- [ ] 분석 도구 (Google Analytics / Vercel Analytics)
- [ ] 성능 모니터링 (Core Web Vitals)
- [ ] 사용자 피드백 수집

### 법적 요건
- [ ] 개인정보처리방침
- [ ] 이용약관
- [x] 데이터 출처 명시 (서울시 상권분석서비스) - 등급계산로직.md에 명시
- [x] 면책 조항 (투자 결정 책임) - 등급계산로직.md 8장에 추가

### SEO & 마케팅
- [ ] 메타 태그 최적화
- [ ] Open Graph 이미지
- [ ] sitemap.xml
- [ ] robots.txt
- [ ] 랜딩 페이지 콘텐츠

---

## 기술 스택

| 영역 | 기술 |
|------|------|
| Frontend | Next.js 15, React, TypeScript |
| Styling | Tailwind CSS, CSS Variables |
| Database | Supabase (PostgreSQL + PostGIS) |
| Map | Kakao Maps SDK |
| Deployment | Vercel (예정) |
| Font | Pretendard Variable |

---

## 파일 구조

```
OpenRisk/
├── app/
│   ├── api/
│   │   └── analyze/
│   │       └── route.ts      # 분석 API (searchQuery 포함)
│   ├── result/
│   │   └── page.tsx          # 결과 페이지 (툴팁 적용)
│   ├── skin-b/
│   │   └── result/
│   │       └── page.tsx      # 대체 스킨 결과 페이지
│   ├── layout.tsx            # 루트 레이아웃
│   ├── page.tsx              # 메인 페이지
│   └── globals.css           # 디자인 시스템
├── components/
│   ├── AreaMap.tsx           # 카카오맵 컴포넌트
│   └── Tooltip.tsx           # 툴팁 컴포넌트 (Portal 기반)
├── lib/
│   ├── engine/
│   │   ├── gradeEngine.ts    # 등급 계산
│   │   ├── copyRenderer.ts   # 해석 문구
│   │   └── index.ts          # exports
│   ├── types.ts              # TypeScript 타입
│   └── supabase.ts           # Supabase 클라이언트
└── docs/
    ├── 개발일지.md            # 개발 일지
    ├── 등급계산로직.md        # 등급 계산 로직 설명
    ├── 데이터명세서.md        # 데이터 구조 명세
    ├── 지표현황.md            # 사용 지표 현황
    ├── 데이터보강계획.md      # 데이터 보강 계획
    └── 정확도개선로드맵.md    # 정확도 개선 계획
```
