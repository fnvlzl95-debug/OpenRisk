# OpenRisk 등급 계산 로직 설명서

> 이 문서는 상권 분석에 사용되는 모든 지표와 등급 계산 공식을 설명합니다.

---

## 1. 사용 지표 (8개)

### 기본 지표 (3개)

| 지표명 | DB 컬럼 | 설명 | 예시 값 |
|--------|---------|------|---------|
| **유동인구 지수** | `traffic_index` | 분기별 총 유동인구를 만 단위로 나눈 값 | 406.7 = 약 407만명 |
| **시간대 편차** | `daypart_variance` | 시간대별 유동인구 분포의 편차 (0~1) | 0.12 = 비교적 균일 |
| **주말 비중** | `weekend_ratio` | 전체 유동인구 중 주말 비중 (0~1) | 0.33 = 33%가 주말 |

### 확장 지표 (5개) - Phase 2

| 지표명 | DB 컬럼 | 설명 | 예시 값 |
|--------|---------|------|---------|
| **상주인구 지수** | `resident_index` | 해당 상권 배후지의 거주 인구 (만 단위) | 1.74 = 약 1.7만명 |
| **직장인구 지수** | `worker_index` | 해당 상권의 직장인 수 (만 단위) | 8.72 = 약 8.7만명 |
| **경쟁 밀도** | `competition_density` | 유사 업종 점포 수 / 전체 점포 수 | 1.09 = 유사업종 9% 많음 |
| **개폐업 변동률** | `open_close_churn` | (개업 + 폐업) / 전체 점포 수 | 0.074 = 7.4% 변동 |
| **비용 압박** | `cost_proxy` | 서울 평균 매출 대비 해당 상권 매출 배수 | 10.5 = 서울 평균의 10.5배 |

---

## 2. 정규화 (0~1 스케일 변환)

모든 지표는 등급 계산 전에 0~1 범위로 정규화됩니다.

```
traffic   = min(traffic_index / 1000, 1)           // 1000만명 기준
variance  = min(daypart_variance, 1)               // 이미 0~1
weekend   = min(weekend_ratio, 1)                  // 이미 0~1
worker    = min(worker_index / 10, 1)              // 10만명 기준
resident  = min(resident_index / 10, 1)            // 10만명 기준
competition = min((competition_density - 1) * 5, 1) // 1.0~1.2 → 0~1
churn     = min(open_close_churn * 10, 1)          // 10% 변동 기준
cost      = min(cost_proxy / 10, 1)                // 서울 평균 10배 기준
```

### 정규화 예시

| 원본 값 | 정규화 공식 | 정규화 결과 |
|---------|-------------|-------------|
| traffic_index = 406.7 | 406.7 / 1000 | 0.407 |
| worker_index = 8.72 | 8.72 / 10 | 0.872 |
| competition_density = 1.09 | (1.09 - 1) × 5 | 0.45 |
| open_close_churn = 0.074 | 0.074 × 10 | 0.74 |
| cost_proxy = 10.5 | 10.5 / 10 | 1.0 (최대) |

---

## 3. 등급 계산 공식

### 등급 종류

| 등급 | 이름 | 설명 | 난이도 |
|------|------|------|--------|
| **A** | A_주거 | 주거 밀집, 안정적 수요 | 1 (쉬움) |
| **B** | B_혼합 | 직주 혼합, 시간대별 전략 필요 | 3 (중간) |
| **C** | C_상업 | 상업 중심, 고위험 고수익 | 5 (어려움) |
| **D** | D_특수 | 관광/이벤트 특화 | 4 (까다로움) |

### 등급별 점수 계산

각 등급에 대한 점수를 계산하고, 가장 높은 점수의 등급이 최종 등급이 됩니다.

#### A등급 점수 (주거형)
```
A_score = (1 - worker) × 0.3      // 직장인 적을수록 좋음
        + (1 - variance) × 0.3    // 시간대 편차 적을수록 좋음
        + (1 - cost) × 0.2        // 비용 압박 낮을수록 좋음
        + (1 - churn) × 0.2       // 개폐업 변동 적을수록 좋음
```
**의미**: 직장인이 적고, 시간대별 변동이 적고, 비용과 변동률이 낮은 안정적인 상권

#### B등급 점수 (혼합형)
```
B_score = workerResidentBalance × 0.3  // 직주 균형 (직장인≈거주민)
        + (1 - |variance - 0.5|) × 0.25 // 중간 편차가 좋음
        + (1 - |competition - 0.5|) × 0.25 // 중간 경쟁이 좋음
        + (1 - |weekend - 0.3|) × 0.2   // 주말 30% 정도가 좋음

workerResidentBalance = 1 - |worker - resident|
```
**의미**: 직장인과 거주민이 균형을 이루고, 모든 지표가 중간 정도인 상권

#### C등급 점수 (상업형)
```
C_score = traffic × 0.25      // 유동인구 많을수록
        + competition × 0.25  // 경쟁 치열할수록
        + churn × 0.25        // 개폐업 변동 클수록
        + cost × 0.25         // 비용 높을수록
```
**의미**: 유동인구 많고, 경쟁 치열하고, 변동성 크고, 비용이 높은 상업 중심 상권

#### D등급 점수 (특수형)
```
D_score = weekend > 0.5 ? weekend × 0.5 : 0
```
**의미**: 주말 비중이 50% 이상인 관광/이벤트 특화 상권

---

## 4. 신뢰도 계산

```
scoreDiff = 1등 점수 - 2등 점수
baseConfidence = 0.6 + scoreDiff × 0.8
confidence = clamp(baseConfidence, 0.5, 0.95)
```

**의미**: 1등과 2등의 점수 차이가 클수록 신뢰도가 높음
- 점수 차이 0 → 신뢰도 60%
- 점수 차이 0.2 → 신뢰도 76%
- 점수 차이 0.4 이상 → 신뢰도 95% (최대)

---

## 5. 판단 근거 (reasons) 추출

등급에 따라 가장 영향력 있는 지표 3개를 선택합니다.

| 등급 | 선택 기준 | 이유 |
|------|-----------|------|
| A등급 | 값이 **낮은** 순 | 안정성이 핵심이므로 낮은 값이 긍정적 |
| C등급 | 값이 **높은** 순 | 상업성이 핵심이므로 높은 값이 특징적 |
| B, D등급 | 값이 **높은** 순 | 두드러진 특성 표시 |

---

## 6. 실제 계산 예시

### 홍대입구역

**원본 지표:**
```
traffic_index: 406.747
daypart_variance: 0.117
weekend_ratio: 0.331
worker_index: 0.719
competition_density: 1.089
open_close_churn: 0.074
cost_proxy: 10.53
```

**정규화:**
```
traffic = 0.407
variance = 0.117
weekend = 0.331
worker = 0.072
competition = 0.447
churn = 0.738
cost = 1.0 (capped)
```

**등급 점수:**
```
A_score = (1-0.072)×0.3 + (1-0.117)×0.3 + (1-1.0)×0.2 + (1-0.738)×0.2
        = 0.278 + 0.265 + 0 + 0.052 = 0.595

B_score = 0.928×0.3 + 0.617×0.25 + 0.447×0.25 + 0.969×0.2
        = 0.278 + 0.154 + 0.112 + 0.194 = 0.738 ✅ (최고)

C_score = 0.407×0.25 + 0.447×0.25 + 0.738×0.25 + 1.0×0.25
        = 0.102 + 0.112 + 0.185 + 0.25 = 0.649

D_score = 0 (주말 비중 50% 미만)
```

**결과:**
- 등급: **B** (B_혼합)
- 신뢰도: 0.738 - 0.649 = 0.089 차이 → 약 **67%**

---

### 강남역

**원본 지표:**
```
traffic_index: 815.688
daypart_variance: 0.127
weekend_ratio: 0.213
worker_index: 8.719
competition_density: 1.098
open_close_churn: 0.048
cost_proxy: 28.26
```

**정규화:**
```
traffic = 0.816
variance = 0.127
weekend = 0.213
worker = 0.872
competition = 0.491
churn = 0.480
cost = 1.0 (capped)
```

**등급 점수:**
```
A_score = (1-0.872)×0.3 + (1-0.127)×0.3 + (1-1.0)×0.2 + (1-0.48)×0.2
        = 0.038 + 0.262 + 0 + 0.104 = 0.404

B_score = (1-|0.872-0.155|)×0.3 + ... ≈ 0.45

C_score = 0.816×0.25 + 0.491×0.25 + 0.480×0.25 + 1.0×0.25
        = 0.204 + 0.123 + 0.120 + 0.25 = 0.697 ✅ (최고)

D_score = 0
```

**결과:**
- 등급: **C** (C_상업)
- 판단 근거: 비용 압박(1.0), 직장인구(0.87), 유동인구(0.82)

---

## 7. 데이터 출처

| 데이터 | 출처 | 파일명 |
|--------|------|--------|
| 유동인구 | 서울시 상권분석서비스 | 유동인구_상권_utf8.csv |
| 직장인구 | 서울시 상권분석서비스 | 직장인구_상권_utf8.csv |
| 상주인구 | 서울시 상권분석서비스 | 상주인구_배후지_utf8.csv |
| 점포 현황 | 서울시 상권분석서비스 | 점포_상권_utf8.csv |
| 추정 매출 | 서울시 상권분석서비스 | 추정매출_상권_utf8.csv |
| 상권변화지표 | 서울시 상권분석서비스 | 상권변화지표_utf8.csv |
| 집객시설 | 서울시 상권분석서비스 | 집객시설_상권_utf8.csv |

---

## 8. 서비스 목적 및 면책 사항

### 서비스 정의

OpenRisk는 **상권 컨설팅 서비스가 아닙니다.**

- 특정 업종이나 입지를 "추천"하지 않습니다
- "안전하다", "좋다", "성공한다" 등의 판단을 제공하지 않습니다
- 매출 예측이나 수익률 추정을 하지 않습니다

OpenRisk는 **리스크 해석 도구**입니다.

- 공공데이터 기반으로 상권 구조를 설명합니다
- "~할 수 있다", "~인 구조이다" 등 사실 기반 해석을 제공합니다
- 사용자가 직접 판단할 수 있도록 정보를 정리합니다

### 데이터 한계

| 항목 | 설명 |
|------|------|
| **데이터 출처** | 서울시 상권분석서비스 공공데이터 |
| **갱신 주기** | 분기별 (최신 데이터 반영까지 1~2개월 지연) |
| **커버리지** | 서울시 상권 약 1,000개 (전체 상권 아님) |
| **정확도** | 공공데이터 특성상 실제와 차이 있음 |

### 면책 조항

1. 본 서비스의 분석 결과는 **참고 자료**이며, 창업·투자 결정의 근거로 사용할 수 없습니다.
2. 분석 결과에 따른 **모든 의사결정의 책임은 사용자**에게 있습니다.
3. 서비스 제공자는 분석 오류, 데이터 지연, 시스템 장애로 인한 **직간접 손해에 대해 책임지지 않습니다.**
4. 실제 창업 시에는 **현장 조사, 전문가 상담, 재무 검토**가 필수입니다.

### 표현 가이드라인

| ❌ 사용하지 않는 표현 | ✅ 대신 사용하는 표현 |
|---------------------|---------------------|
| "안전한 상권입니다" | "변동성이 낮은 구조입니다" |
| "추천합니다" | "~할 수 있습니다" |
| "성공 가능성 높음" | "리스크 요인이 적은 편입니다" |
| "신뢰도 90%" | "8개 지표 중 6개 기반" |
| "투자하세요" | "추가 조사가 필요합니다" |

---

## 9. 향후 개선 계획

1. ✅ **마케팅 탄력성 지수** 추가 (HIGH/MEDIUM/LOW) - 완료
2. ✅ **앵커 시설** (지하철, 대학, 병원) 반영 - 완료
3. ✅ **상권변화지표** (LL/LH/HL/HH) 반영 - 완료
4. ⏳ **업종별 가중치** 차등 적용
5. ⏳ **시계열 트렌드** 분석 (전분기 대비 변화)
6. ⏳ **Lv4: 로컬 신호** (네이버/카카오 데이터) 연동

---

*마지막 업데이트: 2025년 12월*
