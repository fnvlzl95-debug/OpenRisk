# OpenRisk v2 프론트엔드 구현 계획

> 작성일: 2026-01-02
> 버전: 1.0

## 핵심 컨셉: "30초 리포트"
> 창업 초보가 10초 안에 결론을 이해하고, 30초 안에 왜 그런지 파악

### 3가지 핵심 원칙
1. **한눈에 결론** (가능/주의/위험)
2. **왜 그런지** (원인 2~3개만)
3. **뭘 하면 되는지** (액션/대안)

## 현재 상태
- **v2 백엔드**: 완료 (`/api/v2/analyze` POST API)
- **7대 지표 엔진**: 완료 (`lib/v2/` 폴더)
- **업종 카테고리**: 완료 (18개 업종, `lib/categories.ts`)
- **프론트엔드**: v1 API 연동 상태 (수정 필요)
- **상권 등급 체계**: A_주거/B_혼합/C_상업/D_특수 (유지)

---

## Phase 1: 데이터베이스 확인 (우선)

### 작업 1.1: Supabase 테이블 확인
v2 API가 필요로 하는 테이블들이 존재하는지 확인:
- `grid_store_counts` - H3 그리드별 점포 데이터
- `grid_traffic` - H3 그리드별 유동인구 데이터
- `district_rent` - 법정동별 임대료
- `subway` - 지하철역 데이터
- `find_nearest_subway` RPC 함수

### 작업 1.2: 테스트 API 호출
실제 좌표로 `/api/v2/analyze` API 테스트하여 데이터 반환 확인

---

## Phase 2: API 응답 구조 확장 (백엔드)

### 추가 필요 데이터 (피드백 반영)

#### 2.1 CompetitionMetrics 확장
```typescript
interface CompetitionMetrics {
  // 기존
  total: number
  sameCategory: number
  density: number
  densityLevel: 'low' | 'medium' | 'high'

  // 추가
  densityPerKm2?: number           // ㎢당 밀도
  percentile?: number              // 상위 몇 % (예: 15)
  recentTrend?: {                  // 최근 3개월 트렌드
    newStores: number
    closedStores: number
    trend: 'increasing' | 'stable' | 'decreasing'
  }
}
```

#### 2.2 TrafficMetrics 확장
```typescript
interface TrafficMetrics {
  // 기존 유지
  index: number
  level: TrafficLevel
  peakTime: 'morning' | 'day' | 'night'
  weekendRatio: number
  timePattern: { morning, day, night }

  // 추가
  percentile?: number              // 구 내 상위 몇 %
  peakHours?: string               // "19~22시" (영업시간 추천용)
  customerType?: 'commuter' | 'resident' | 'mixed'  // 고객 유형
}
```

#### 2.3 CostMetrics 확장
```typescript
interface CostMetrics {
  // 기존
  avgRent: number
  level: 'low' | 'medium' | 'high'
  districtAvg?: number

  // 추가
  vsDistrictPercent?: number       // 구 평균 대비 +몇%
  estimatedMinSales?: number       // 손익분기 최소 일매출 추정
}
```

#### 2.4 interpretation 확장 (초보용 문장)
```typescript
interface Interpretation {
  summary: string
  risks: string[]
  opportunities: string[]

  // 추가: 각 지표별 초보용 해석 문장
  easyExplanations: {
    competition: string    // "카페가 이미 많아 차별화 없으면 매출 분산 위험"
    traffic: string        // "유동은 충분하지만 피크가 밤이라 낮 장사는 약함"
    cost: string           // "임대료가 높아 작은 평수/테이크아웃형이 유리"
    survival: string       // "최근 점포가 줄어드는 구간이라 운영 난이도 높음"
    timePattern: string    // "주말 비중이 높아 평일 매출 방어 전략 필요"
    areaType: string       // "상업형이라 유입은 좋지만 경쟁·임대료도 높음"
    anchor: string         // "역이 가까워 유입은 안정적"
  }

  // 추가: Top 2 칩으로 표시할 핵심 요인
  topFactors: {
    risks: string[]        // ["임대료 높음", "동종 18개"]
    opportunities: string[] // ["역세권 150m", "야간 유동 강함"]
  }

  // 추가: 점수 기여도 (신뢰 구축용)
  scoreContribution: {
    competition: number    // 25%
    cost: number           // 20%
    traffic: number        // 15%
    survival: number       // 20%
    anchor: number         // 10%
    timePattern: number    // 10%
  }
}
```

---

## Phase 3: 프론트엔드 컴포넌트

### 파일 구조
```
components/v2/
├── RiskScoreHero.tsx      # 리스크 점수 + 한줄 요약 + Top 4 칩
├── ScoreBreakdown.tsx     # "왜 이 점수?" 기여도 바
├── MetricCard.tsx         # 공통 카드 래퍼 (3줄 공식)
├── CompetitionCard.tsx    # 경쟁 밀도 + 트렌드
├── TrafficCard.tsx        # 유동인구 + 피크타임 → 영업시간 추천
├── CostCard.tsx           # 임대료 + 구평균 대비 + 손익분기 힌트
├── SurvivalCard.tsx       # 폐업률 + 생존 신호 번역
├── TimePatternCard.tsx    # 시간대 → 매출 패턴 번역
├── AreaTypeCard.tsx       # 상권 성격 → 행동 가이드
├── AnchorCard.tsx         # 앵커 → 유입 유형 번역
└── LevelBadge.tsx         # 레벨 뱃지
```

### 카드 통일 템플릿 (3줄 공식)
```
(1) 한 줄 핵심 값 (굵게)           예: "18개"
(2) 레벨 뱃지 + 짧은 판정          예: 🔴 높음
(3) 초보용 해석 + 추천 액션 1개    예: "차별화 없으면 매출 분산 위험"
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━
    [자세히] 클릭 시 확장:
    - 기준/비교 (구 평균, 상위 %)
    - 시간대/분포/트렌드
    - 데이터 근거
```

### 3.1 CompetitionCard
```
+----------------------------------+
| 경쟁 밀도                         |
|                                  |
|     18개 (카페)                  |  ← 핵심 값
|     🔴 높음 · 상위 15%           |  ← 레벨 + 비교
|                                  |
|  "차별화 없으면 매출 분산 위험"   |  ← 초보용 해석
|                                  |
|  📈 최근 3개월 +3개 (증가세)     |  ← 트렌드 (추가)
|                                  |
|  [자세히 ▼]                      |
+----------------------------------+
```

### 3.2 TrafficCard
```
+----------------------------------+
| 유동인구                          |
|                                  |
|     2.3만                        |  ← 핵심 값
|     🟢 높음 · 구 상위 20%        |  ← 레벨 + 퍼센타일
|                                  |
|  ▂ ▅ ▇  피크: 19~22시           |  ← 시간대 바 + 피크
|  아침 낮 밤                       |
|                                  |
|  "저녁형 업종에 유리"             |  ← 영업시간 추천
|                                  |
|  [자세히 ▼]                      |
+----------------------------------+
```

### 3.3 CostCard
```
+----------------------------------+
| 임대료                           |
|                                  |
|     150만원/평                   |  ← 핵심 값
|     🔴 높음 · 구 평균 +25%       |  ← 레벨 + 비교
|                                  |
|  "고정비 압박 큼 → 작은 평수 유리"|  ← 초보용 해석
|                                  |
|  💡 최소 일매출 ~80만원 필요      |  ← 손익분기 힌트 (추가)
|                                  |
|  [자세히 ▼]                      |
+----------------------------------+
```

### 3.4 SurvivalCard
```
+----------------------------------+
| 생존 신호                         |
|                                  |
|     폐업 8.5% · 개업 12.3%       |  ← 핵심 값
|     🟡 보통 · 순증감 +4개        |  ← 레벨 + 순증감
|                                  |
|  "늘어나는 시장 → 진입 기회"      |  ← 생존 신호 번역
|                                  |
|  [자세히 ▼]                      |
+----------------------------------+
```

### 3.5 TimePatternCard
```
+----------------------------------+
| 매출 패턴                         |
|                                  |
|     주말형 (주말 60%)            |  ← 핵심 값
|     🟡 주의                      |  ← 레벨
|                                  |
|  "주중 고정비 버티기 필요"        |  ← 초보용 해석
|                                  |
|  [자세히 ▼]                      |
+----------------------------------+
```

### 3.6 AreaTypeCard (A/B/C/D 유지)
```
+----------------------------------+
| 상권 성격                         |
|                                  |
|     C_상업형                     |  ← 핵심 값
|     🏢 유입↑ 회전↑ 경쟁↑         |  ← 특성 태그
|                                  |
|  "유입은 좋지만 경쟁·임대료 높음" |  ← 초보용 해석
|                                  |
|  [자세히 ▼]                      |
+----------------------------------+
```

### 3.7 AnchorCard (유입 유형 번역)
```
+----------------------------------+
| 유입 시설                         |
|                                  |
| 🚇 선릉역 150m    → 통근 유입    |
| ☕ 스타벅스 3개   → 상권 활성화   |
| 🛒 이마트 800m   → 목적형 방문   |
| 🏬 백화점 1.2km  → (먼 편)       |
|                                  |
|  "역세권은 임대료·경쟁도 높아요"  |  ← 주의사항
+----------------------------------+
```

---

## Phase 4: Hero 섹션 (10초 판단)

### RiskScoreHero 컴포넌트
```
+-------------------------------------------------------+
|  📍 강남구 역삼동 · 카페                              |
|                                                       |
|              42                                       |
|          리스크 점수                                  |
|     [========●======]                                 |
|                                                       |
|     🟡 MEDIUM · 주의 필요                             |
|     C_상업형                                          |
|                                                       |
|  "경쟁은 치열하지만, 역세권 유동이 충분합니다"        |
|                                                       |
|  ┌─────────────────────────────────────────────┐      |
|  │ 🔴 임대료 높음   🔴 동종 18개               │      |
|  │ 🟢 역세권 150m   🟢 야간 유동 강함          │      |
|  └─────────────────────────────────────────────┘      |
|                                                       |
|  신뢰도: 높음 · 데이터: 2025.Q1                       |
+-------------------------------------------------------+
```

**핵심 포인트:**
- 점수보다 **이유(칩 4개)가 먼저 눈에** 들어오게
- 상권 등급(A/B/C/D) 함께 표시
- 신뢰도 + 데이터 기준일 표시

---

## Phase 5: 점수 기여도 섹션

### ScoreBreakdown 컴포넌트
```
+-------------------------------------------------------+
| 왜 이 점수인가요?                                      |
|                                                       |
| 경쟁      [████████████████████░░░░] 25% ▲           |
| 임대료    [████████████████░░░░░░░░] 20% ▲           |
| 생존율    [████████████████░░░░░░░░] 20% ▼           |
| 유동인구  [████████████░░░░░░░░░░░░] 15% ▼           |
| 앵커시설  [████████░░░░░░░░░░░░░░░░] 10% ▼           |
| 시간대    [████████░░░░░░░░░░░░░░░░] 10% ━           |
|                                                       |
| ▲ 점수 올린 요인  ▼ 점수 낮춘 요인                    |
+-------------------------------------------------------+
```

**핵심 포인트:**
- 복잡한 수식 말고 "이 점수를 만든 재료"만 보여줌
- ▲▼ 아이콘으로 점수에 미친 영향 직관적 표시

---

## Phase 6: 결과 페이지 수정

### 수정 파일: app/result/page.tsx

### 레이아웃 구조 (스크롤 순서 = 중요도 순서)
```
1. [RiskScoreHero]        ← 10초 판단 (Above the fold)
2. [ScoreBreakdown]       ← "왜 이 점수?" (신뢰 구축)
3. [핵심 3카드]           ← 경쟁 / 임대료 / 유동인구 (결정 핵심)
4. [나머지 4카드]         ← 생존 / 시간대 / 상권성격 / 앵커
5. [지도]                 ← H3 셀 + 앵커 마커 + 반경 토글
6. [액션 바]              ← AI 분석 / 다시 분석 / 공유
7. [면책 + 데이터 출처]
```

### 작업 6.1: API 호출 변경
```tsx
const res = await fetch('/api/v2/analyze', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ lat, lng, targetCategory })
})
```

### 작업 6.2: Progressive Disclosure (점진적 공개)
- 카드 기본: 3줄 (핵심값 + 레벨 + 한줄 해석)
- [자세히] 클릭 시: 기준/비교, 트렌드, 데이터 근거

---

## Phase 7: 추가 데이터 소스 (향후)

### 우선순위별 추가 지표

| 우선순위 | 지표 | 데이터 소스 | 효과 |
|---------|------|------------|------|
| ⭐⭐⭐ | 트렌드 (점포 수 추세) | 기존 데이터 비교 | "지금 들어가도 되나?" 답변 |
| ⭐⭐⭐ | 수요-공급 밸런스 | 유동인구/점포수 비율 | 가장 직관적인 판단 근거 |
| ⭐⭐ | 고객층 힌트 | 주거/직장 비율 | "어떤 고객인지" 힌트 |
| ⭐⭐ | 퍼센타일 비교 | 구/시 평균 대비 | 상대적 위치 파악 |
| ⭐ | 공실률 | 부동산 API | 시장 건강도 신호 |
| ⭐ | 리뷰 밀도 | 네이버/구글 | 소비력 프록시 |

### 현재 데이터로 계산 가능한 것
- ✅ 트렌드: `prev_period_count` vs `total_count` 비교
- ✅ 수요-공급: `traffic_index` / `sameCategory`
- ✅ 퍼센타일: 구별 데이터 집계 후 순위 계산
- ❓ 고객층: `resident_index`, `worker_index` (v1에 있음)

---

## Phase 8: 신뢰 요소

### 데이터 신뢰도 표시
```
┌────────────────────────────────────────┐
│ 데이터 신뢰도: 높음 ✓                  │
│                                        │
│ • 점포 데이터: 2025.Q1 (3개월 이내)    │
│ • 유동인구: 2025.01 (1개월 이내)       │
│ • 표본: 87개 점포 분석                 │
│                                        │
│ ⚠️ 현장 확인 권장 사항:                │
│   □ 실제 임대료 (공인중개사)           │
│   □ 주변 경쟁 매장 직접 확인           │
│   □ 시간대별 유동 체크                 │
└────────────────────────────────────────┘
```

---

## 구현 우선순위

### 1단계: 기반 (DB + 백엔드)
1. Supabase 테이블 확인
2. API 응답 구조 확장 (interpretation 확장)
3. 초보용 해석 문장 생성 로직

### 2단계: 프론트엔드 핵심
4. LevelBadge, MetricCard 공통 컴포넌트
5. RiskScoreHero (10초 판단)
6. 핵심 3카드 (경쟁/임대료/유동인구)

### 3단계: 프론트엔드 완성
7. 나머지 4카드
8. ScoreBreakdown (점수 기여도)
9. 지도 확장 (반경 토글)
10. 결과 페이지 조립

### 4단계: 연동
11. 홈페이지 → 결과 페이지 플로우
12. AI 요약 연동

---

## 수정할 파일 목록

| 파일 | 작업 |
|------|------|
| `lib/v2/types.ts` | 타입 확장 (percentile, trend, easyExplanations) |
| `lib/v2/riskEngine.ts` | 초보용 해석 문장 생성 로직 추가 |
| `app/api/v2/analyze/route.ts` | 확장된 응답 구조 반영 |
| `app/result/page.tsx` | v2 API 연동, 새 레이아웃 |
| `app/page.tsx` | 검색 흐름 수정 |
| `components/v2/*.tsx` | 신규 생성 (8개 컴포넌트) |

---

## 최종 화면 와이어프레임

```
+------------------------------------------------------------------+
| OpenRisk                                    [다시 분석] [공유]    |
+==================================================================+
|                                                                   |
|  📍 강남구 역삼동 · 카페                    C_상업형             |
|                                                                   |
|              42                                                   |
|          리스크 점수                                              |
|     [========●======]  🟡 MEDIUM                                  |
|                                                                   |
|  "경쟁은 치열하지만, 역세권 유동이 충분합니다"                   |
|                                                                   |
|  ┌─────────────────────────────────────────────────────────┐      |
|  │ 🔴 임대료 높음   🔴 동종 18개   🟢 역세권   🟢 야간 유동 │      |
|  └─────────────────────────────────────────────────────────┘      |
|                                                                   |
+------------------------------------------------------------------+
| 왜 이 점수인가요?                                                 |
|                                                                   |
| 경쟁      [████████████████████░░░░] 25% ▲                       |
| 임대료    [████████████████░░░░░░░░] 20% ▲                       |
| 유동인구  [████████████░░░░░░░░░░░░] 15% ▼                       |
+------------------------------------------------------------------+
|                                                                   |
| +----------+ +----------+ +----------+                            |
| | 경쟁밀도 | | 유동인구 | | 임대료   |     ← 핵심 3카드         |
| |   18개   | |  2.3만   | | 150만/평 |                            |
| | 🔴 높음  | | 🟢 높음  | | 🔴 높음  |                            |
| | "차별화  | | "저녁형  | | "작은    |                            |
| |  필요"   | |  유리"   | |  평수"   |                            |
| +----------+ +----------+ +----------+                            |
|                                                                   |
| +----------+ +----------+ +----------+ +----------+               |
| | 생존신호 | | 매출패턴 | | 상권성격 | | 유입시설 |               |
| |  +4개    | | 주말형   | | C_상업형 | | 🚇150m  |               |
| +----------+ +----------+ +----------+ +----------+               |
|                                                                   |
| +------------------------------------------------------+          |
| |                    [카카오 지도]                     |          |
| |        ● 분석 지점  ⬡ H3 셀  🚇🛒 앵커 마커         |          |
| |        [300m] [500m] 반경 토글                       |          |
| +------------------------------------------------------+          |
|                                                                   |
| [🤖 AI 상세 분석]    [🔄 다시 분석]    [🔗 공유]                 |
|                                                                   |
| ─────────────────────────────────────────────────────────         |
| 데이터: 2025.Q1 · 신뢰도: 높음 · 서울시 공공데이터 기반           |
| ⚠️ 투자 결정 전 현장 확인을 권장합니다                           |
+------------------------------------------------------------------+
```

---

## 다음 단계
1. Supabase 테이블 존재 여부 확인
2. API 테스트 호출로 데이터 확인
3. 타입/백엔드 확장
4. 프론트엔드 컴포넌트 순차 구현
