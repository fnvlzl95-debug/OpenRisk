# OpenRisk 공공데이터 지표 현황

> 마지막 업데이트: 2026-01-02 (v2.0)

---

## v2.0 7대 지표 시스템 (신규)

### 개요
- **분석 단위**: H3 헥사곤 그리드 (해상도 9, ~174m)
- **입력**: 좌표 (lat, lng) + 업종 카테고리
- **커버리지**: 서울/경기/인천

### 7대 핵심 지표

| # | 지표 | 설명 | 데이터 소스 | 구현 파일 |
|---|------|------|------------|----------|
| 1 | **경쟁 밀도** | 반경 내 동종업종 점포 수 | grid_store_counts | riskEngine.ts |
| 2 | **유동인구 지수** | 지하철+버스 기반 지수 (0~100) | subway_stations, bus_stops | traffic-index.ts |
| 3 | **임대료** | 구별 평균 추정 (만원/평) | 내부 추정 | route.ts |
| 4 | **폐업 위험도** | 업종별 생존율 기반 추정 | 통계청 데이터 기반 | closure-risk.ts |
| 5 | **앵커 시설** | 지하철/스타벅스/마트/백화점 | DB + 카카오 POI | route.ts |
| 6 | **시간대 특성** | 아침/낮/저녁 유동인구 비율 | 지하철 시간대별 승하차 | traffic-index.ts |
| 7 | **상권 성격** | A_주거/B_혼합/C_상업/D_특수 | 업종 분포 분석 | riskEngine.ts |

### 업종별 가중치

```typescript
// 예: 카페 업종
cafe: {
  competition: 0.35,  // 경쟁 중요
  cost: 0.25,         // 임대료 중요
  survival: 0.20,     // 폐업률 반영
  traffic: 0.15,      // 유동인구
  anchor: 0.05,       // 앵커 시설
}
```

### 리스크 레벨

| 레벨 | 점수 범위 | 설명 |
|------|----------|------|
| LOW | 0~29 | 창업 리스크가 낮은 지역 |
| MEDIUM | 30~49 | 일반적인 수준의 리스크 |
| HIGH | 50~69 | 신중한 검토 필요 |
| VERY_HIGH | 70~100 | 창업 권장하지 않음 |

### 앵커 시설 상세

| 시설 | 검색 반경 | 리스크 영향 |
|------|----------|------------|
| 지하철 | 1km | 100m 이내 = 0점, 300m = 10점, 500m = 20점 |
| 스타벅스 | 1km | 3개 이상 = 0점 (핵심상권), 1개 = 5점 |
| 대형마트 | 2km | 없음 = 10점 |
| 백화점 | 2km | 없음 = 5점 |

### 시간대 추정 패턴

hourly_data가 없는 역에 적용:

| 유형 | 조건 | morning | day | night |
|------|------|---------|-----|-------|
| 출퇴근형 | 일 3만 이하 | 38% | 28% | 34% |
| 상업형 | 일 10만 이상 | 25% | 42% | 33% |
| 혼합형 | 중간 | 30% | 36% | 34% |

---

## v1 데이터 소스 (서울시 공공데이터)

| 파일 | 내용 | 사용 |
|------|------|:----:|
| `trade_areas.geojson` | 상권 영역 폴리곤, 중심좌표 | ✅ |
| `유동인구_상권_utf8.csv` | 유동인구 데이터 | ✅ |
| `직장인구_상권_utf8.csv` | 직장인구 데이터 | ✅ |
| `상주인구_배후지_utf8.csv` | 상주인구 데이터 | ✅ |
| `점포_상권_utf8.csv` | 점포 현황 데이터 | ✅ |
| `추정매출_상권_utf8.csv` | 매출 추정 데이터 | ✅ |
| `상권변화지표_utf8.csv` | 상권변화지표 (LL/LH/HL/HH) | ✅ |
| `집객시설_상권_utf8.csv` | 집객시설 (지하철/대학/병원) | ✅ |

---

## 2. DB 테이블별 저장 현황

### `trade_areas` 테이블

| 컬럼 | 설명 | 저장 | 사용 |
|------|------|:----:|:----:|
| `id` | 상권 코드 | ✅ | ✅ |
| `name` | 상권명 | ✅ | ✅ |
| `district` | 시군구명 | ✅ | ✅ |
| `center_lat/lng` | 중심 좌표 | ✅ | ✅ |
| `polygon` | PostGIS geometry | ✅ | ✅ |

### `area_metrics` 테이블

| 컬럼 | 설명 | 저장 | 등급계산 | 화면표시 |
|------|------|:----:|:--------:|:--------:|
| `period` | 기준 년분기 | ✅ | ❌ | ✅ |
| `traffic_index` | 유동인구 지수 (만 단위) | ✅ | ✅ | ✅* |
| `daypart_variance` | 시간대 편차 (0~1) | ✅ | ✅ | ❌ |
| `weekend_ratio` | 주말 비중 (0~1) | ✅ | ✅ | ✅** |
| `resident_index` | 상주인구 지수 (만 단위) | ✅ | ✅ | ✅ |
| `worker_index` | 직장인구 지수 (만 단위) | ✅ | ✅ | ✅ |
| `competition_density` | 경쟁 밀도 | ✅ | ✅ | ❌ |
| `open_close_churn` | 개폐업 변동률 | ✅ | ✅ | ❌ |
| `cost_proxy` | 비용 대리지표 | ✅ | ✅ | ❌ |

> \* `traffic_total = traffic_index × 10,000`으로 변환하여 표시
> \*\* `traffic_weekend = traffic_total × weekend_ratio`로 파생

### `area_anchors` 테이블 (Phase 2-C)

| 컬럼 | 설명 | 저장 | 사용 |
|------|------|:----:|:----:|
| `area_id` | 상권 코드 | ✅ | ✅ |
| `anchor_type` | 앵커 유형 (subway/university/hospital) | ✅ | ✅ |

### `area_change_indicators` 테이블 (Phase 2-C)

| 컬럼 | 설명 | 저장 | 사용 |
|------|------|:----:|:----:|
| `area_id` | 상권 코드 | ✅ | ✅ |
| `period` | 기준 년분기 | ✅ | ✅ |
| `indicator` | 변화지표 (LL/LH/HL/HH) | ✅ | ✅ |

---

## 3. 등급 계산 알고리즘 (Phase 2)

`lib/engine/gradeEngine.ts`에서 **8개 지표** 사용:

```
Grade = argmax(A_score, B_score, C_score, D_score)

각 등급 점수 계산:
- A_score = f(worker↓, variance↓, cost↓, churn↓)  // 안정성 기반
- B_score = f(workerResidentBalance, ...)         // 직주 균형 기반
- C_score = f(traffic↑, competition↑, churn↑, cost↑)  // 상업성 기반
- D_score = f(weekend > 0.5)                      // 주말 비중 기반
```

자세한 계산 공식은 `등급계산로직.md` 참조

---

## 4. 사용 현황 요약

| 지표 | 공공데이터 출처 | 정규화 | 용도 |
|------|----------------|--------|------|
| **traffic_index** | 유동인구_상권 | ÷ 1000 | 등급 + 표시 |
| **daypart_variance** | 유동인구_상권 (시간대별) | 0~1 그대로 | 등급 |
| **weekend_ratio** | 유동인구_상권 (요일별) | 0~1 그대로 | 등급 + 표시 |
| **resident_index** | 상주인구_배후지 | ÷ 10 | 등급 + 표시 |
| **worker_index** | 직장인구_상권 | ÷ 10 | 등급 + 표시 |
| **competition_density** | 점포_상권 | (x-1)×5 | 등급 |
| **open_close_churn** | 점포_상권 | ×10 | 등급 |
| **cost_proxy** | 추정매출_상권 | ÷ 10 | 등급 |

---

## 5. Phase 2-C 추가 지표

### 앵커 시설 (Anchors)

| 유형 | 설명 | 마케팅 탄성 영향 |
|------|------|-----------------|
| `subway` | 지하철역 인근 | 탄성↓ (입지 의존) |
| `university` | 대학교 인근 | 탄성↑ (SNS 민감) |
| `hospital` | 병원 인근 | 탄성↓ (입지 의존) |

### 상권변화지표 (Change Indicator)

| 지표 | 의미 | 설명 |
|------|------|------|
| `LL` | 정체 | 신규↓ 폐업↓ - 변화 적은 상권 |
| `LH` | 활성 | 신규↓ 폐업↑ - 신규 업체에 기회 |
| `HL` | 포화 | 신규↑ 폐업↓ - 기존 업체 우위 |
| `HH` | 격변 | 신규↑ 폐업↑ - 변동성 높음 |

### 마케팅 탄력성 (Marketing Elasticity)

| 레벨 | 의미 | 조건 |
|------|------|------|
| `HIGH` | 높음 | 주말 비중 높고, 앵커 없고, 경쟁 높음 |
| `MEDIUM` | 중간 | 중간 수준 |
| `LOW` | 낮음 | 상주인구 높거나 앵커 시설 있음 |

---

## 6. 데이터 커버리지

API 응답에 `dataQuality` 필드로 데이터 품질 정보 제공:

```typescript
dataQuality: {
  availableMetrics: 8,    // 유효한 지표 수
  totalMetrics: 8,        // 전체 지표 수
  coverage: 'high'        // high(≥6) / medium(4~5) / low(≤3)
}
```

---

## 7. 향후 확장 계획

### 완료 ✅
- 8지표 등급 계산
- 앵커 시설 반영
- 상권변화지표 반영
- 마케팅 탄력성 지수
- 데이터 커버리지 표시

### 예정 ⏳
- 업종별 가중치 차등 적용
- 시계열 트렌드 분석
- Lv4: 로컬 신호 연동
