# OpenRisk 공공데이터 지표 현황

> 마지막 업데이트: 2024-12-30 (Phase 2-C)

## 1. 데이터 소스 (서울시 공공데이터)

| 파일 | 내용 | 사용 |
|------|------|:----:|
| `trade_areas.geojson` | 상권 영역 폴리곤, 중심좌표 | ✅ |
| `유동인구_상권_utf8.csv` | 유동인구 데이터 | ✅ |
| `직장인구_상권_utf8.csv` | 직장인구 데이터 | ✅ |
| `상주인구_배후지_utf8.csv` | 상주인구 데이터 | ✅ |
| `점포_상권_utf8.csv` | 점포 현황 데이터 | ✅ |
| `추정매출_상권_utf8.csv` | 매출 추정 데이터 | ✅ |
| `상권변화지표_utf8.csv` | 상권변화지표 (LL/LH/HL/HH) | ✅ |
| `집객시설_상권_utf8.csv` | 집객시설 (지하철/대학/병원) | ✅ |

---

## 2. DB 테이블별 저장 현황

### `trade_areas` 테이블

| 컬럼 | 설명 | 저장 | 사용 |
|------|------|:----:|:----:|
| `id` | 상권 코드 | ✅ | ✅ |
| `name` | 상권명 | ✅ | ✅ |
| `district` | 시군구명 | ✅ | ✅ |
| `center_lat/lng` | 중심 좌표 | ✅ | ✅ |
| `polygon` | PostGIS geometry | ✅ | ✅ |

### `area_metrics` 테이블

| 컬럼 | 설명 | 저장 | 등급계산 | 화면표시 |
|------|------|:----:|:--------:|:--------:|
| `period` | 기준 년분기 | ✅ | ❌ | ✅ |
| `traffic_index` | 유동인구 지수 (만 단위) | ✅ | ✅ | ✅* |
| `daypart_variance` | 시간대 편차 (0~1) | ✅ | ✅ | ❌ |
| `weekend_ratio` | 주말 비중 (0~1) | ✅ | ✅ | ✅** |
| `resident_index` | 상주인구 지수 (만 단위) | ✅ | ✅ | ✅ |
| `worker_index` | 직장인구 지수 (만 단위) | ✅ | ✅ | ✅ |
| `competition_density` | 경쟁 밀도 | ✅ | ✅ | ❌ |
| `open_close_churn` | 개폐업 변동률 | ✅ | ✅ | ❌ |
| `cost_proxy` | 비용 대리지표 | ✅ | ✅ | ❌ |

> \* `traffic_total = traffic_index × 10,000`으로 변환하여 표시
> \*\* `traffic_weekend = traffic_total × weekend_ratio`로 파생

### `area_anchors` 테이블 (Phase 2-C)

| 컬럼 | 설명 | 저장 | 사용 |
|------|------|:----:|:----:|
| `area_id` | 상권 코드 | ✅ | ✅ |
| `anchor_type` | 앵커 유형 (subway/university/hospital) | ✅ | ✅ |

### `area_change_indicators` 테이블 (Phase 2-C)

| 컬럼 | 설명 | 저장 | 사용 |
|------|------|:----:|:----:|
| `area_id` | 상권 코드 | ✅ | ✅ |
| `period` | 기준 년분기 | ✅ | ✅ |
| `indicator` | 변화지표 (LL/LH/HL/HH) | ✅ | ✅ |

---

## 3. 등급 계산 알고리즘 (Phase 2)

`lib/engine/gradeEngine.ts`에서 **8개 지표** 사용:

```
Grade = argmax(A_score, B_score, C_score, D_score)

각 등급 점수 계산:
- A_score = f(worker↓, variance↓, cost↓, churn↓)  // 안정성 기반
- B_score = f(workerResidentBalance, ...)         // 직주 균형 기반
- C_score = f(traffic↑, competition↑, churn↑, cost↑)  // 상업성 기반
- D_score = f(weekend > 0.5)                      // 주말 비중 기반
```

자세한 계산 공식은 `등급계산로직.md` 참조

---

## 4. 사용 현황 요약

| 지표 | 공공데이터 출처 | 정규화 | 용도 |
|------|----------------|--------|------|
| **traffic_index** | 유동인구_상권 | ÷ 1000 | 등급 + 표시 |
| **daypart_variance** | 유동인구_상권 (시간대별) | 0~1 그대로 | 등급 |
| **weekend_ratio** | 유동인구_상권 (요일별) | 0~1 그대로 | 등급 + 표시 |
| **resident_index** | 상주인구_배후지 | ÷ 10 | 등급 + 표시 |
| **worker_index** | 직장인구_상권 | ÷ 10 | 등급 + 표시 |
| **competition_density** | 점포_상권 | (x-1)×5 | 등급 |
| **open_close_churn** | 점포_상권 | ×10 | 등급 |
| **cost_proxy** | 추정매출_상권 | ÷ 10 | 등급 |

---

## 5. Phase 2-C 추가 지표

### 앵커 시설 (Anchors)

| 유형 | 설명 | 마케팅 탄성 영향 |
|------|------|-----------------|
| `subway` | 지하철역 인근 | 탄성↓ (입지 의존) |
| `university` | 대학교 인근 | 탄성↑ (SNS 민감) |
| `hospital` | 병원 인근 | 탄성↓ (입지 의존) |

### 상권변화지표 (Change Indicator)

| 지표 | 의미 | 설명 |
|------|------|------|
| `LL` | 정체 | 신규↓ 폐업↓ - 변화 적은 상권 |
| `LH` | 활성 | 신규↓ 폐업↑ - 신규 업체에 기회 |
| `HL` | 포화 | 신규↑ 폐업↓ - 기존 업체 우위 |
| `HH` | 격변 | 신규↑ 폐업↑ - 변동성 높음 |

### 마케팅 탄력성 (Marketing Elasticity)

| 레벨 | 의미 | 조건 |
|------|------|------|
| `HIGH` | 높음 | 주말 비중 높고, 앵커 없고, 경쟁 높음 |
| `MEDIUM` | 중간 | 중간 수준 |
| `LOW` | 낮음 | 상주인구 높거나 앵커 시설 있음 |

---

## 6. 데이터 커버리지

API 응답에 `dataQuality` 필드로 데이터 품질 정보 제공:

```typescript
dataQuality: {
  availableMetrics: 8,    // 유효한 지표 수
  totalMetrics: 8,        // 전체 지표 수
  coverage: 'high'        // high(≥6) / medium(4~5) / low(≤3)
}
```

---

## 7. 향후 확장 계획

### 완료 ✅
- 8지표 등급 계산
- 앵커 시설 반영
- 상권변화지표 반영
- 마케팅 탄력성 지수
- 데이터 커버리지 표시

### 예정 ⏳
- 업종별 가중치 차등 적용
- 시계열 트렌드 분석
- Lv4: 로컬 신호 연동
